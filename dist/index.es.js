/** rollup-plugin-total-size
 *
 * @author halo951(https://github.com/halo951)
 * @license MIT
 */
import e from"chalk";import{gzipSync as t}from"zlib";import{compress as i}from"brotli-wasm";import n from"boxen";import r from"prettier";function o(e){return e.length}function l(e){const t="string"==typeof e?e.codePointAt(0):0;return 67===t||99===t?99:76===t||108===t?108:82===t||114===t?114:0}const s=e=>{let t="";for(let i=0;i<e.length;i++)t+=String.fromCharCode(e[i]);return t},p=e=>{let t=[];for(let i=0,n=e.length;i<n;++i)t.push(e.charCodeAt(i));return new Uint8Array(t)},a=(a={})=>{const c={};return{name:"rollup-plugin-total-size",async generateBundle(e,n){if(!a.disable)for(const e in n){const r=n[e];let o;"asset"===r.type?o="string"==typeof r.source?r.source:s(r.source):"chunk"===r.type&&(o=r.code);const l=t(o),a=await i(p(o));c[e]={originSize:o.length,gzippedSize:l.length,compressSize:a.length}}},closeBundle(){if(a.disable)return;let t=[["file","origin size","gzipped size","compressed size"].map((t=>e.blue(t)))];const i=t=>{let i=a.max&&t>1024*a.max;return e[i?"yellow":"white"]((e=>Number((e/1024).toFixed(2)))(t)+"kb")},s=e=>Object.values(c).map((t=>t[e])).reduce(((e,t)=>e+t),0);for(const e in c){const{originSize:n,gzippedSize:r,compressSize:o}=c[e];t.push([e,i(n),i(r),i(o)])}a.total&&(a.max=0,t.push(["总计",i(s("originSize")),i(s("gzippedSize")),i(s("compressSize"))]));let p=function(e,t={}){const i=(t.align||[]).concat(),n=t.stringLength||o,r=[],s=[],p=[],a=[];let c=0,g=-1;for(;++g<e.length;){const i=[],r=[];let o=-1;for(e[g].length>c&&(c=e[g].length);++o<e[g].length;){const l=null==(m=e[g][o])?"":String(m);if(!1!==t.alignDelimiters){const e=n(l);r[o]=e,(void 0===a[o]||e>a[o])&&(a[o]=e)}i.push(l)}s[g]=i,p[g]=r}var m;let u=-1;if("object"==typeof i&&"length"in i)for(;++u<c;)r[u]=l(i[u]);else{const e=l(i);for(;++u<c;)r[u]=e}u=-1;const h=[],d=[];for(;++u<c;){const e=r[u];let i="",n="";99===e?(i=":",n=":"):108===e?i=":":114===e&&(n=":");let o=!1===t.alignDelimiters?1:Math.max(1,a[u]-i.length-n.length);const l=i+"-".repeat(o)+n;!1!==t.alignDelimiters&&(o=i.length+o+n.length,o>a[u]&&(a[u]=o),d[u]=o),h[u]=l}s.splice(1,0,h),p.splice(1,0,d),g=-1;const f=[];for(;++g<s.length;){const e=s[g],i=p[g];u=-1;const n=[];for(;++u<c;){const o=e[u]||"";let l="",s="";if(!1!==t.alignDelimiters){const e=a[u]-(i[u]||0),t=r[u];114===t?l=" ".repeat(e):99===t?e%2?(l=" ".repeat(e/2+.5),s=" ".repeat(e/2-.5)):(l=" ".repeat(e/2),s=l):s=" ".repeat(e)}!1===t.delimiterStart||u||n.push("|"),!1===t.padding||!1===t.alignDelimiters&&""===o||!1===t.delimiterStart&&!u||n.push(" "),!1!==t.alignDelimiters&&n.push(l),n.push(o),!1!==t.alignDelimiters&&n.push(s),!1!==t.padding&&n.push(" "),!1===t.delimiterEnd&&u===c-1||n.push("|")}f.push(!1===t.delimiterEnd?n.join("").replace(/ +$/,""):n.join(""))}return f.join("\n")}(t);p=r.format(p,{parser:"markdown"}),console.log(n(p,{title:"rollup bundle size",padding:{top:1,bottom:0,left:2,right:2},borderColor:"#0969da"}))}}};export{a as totalSize};
