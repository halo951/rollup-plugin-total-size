/** rollup-plugin-total-size
 *
 * @author halo951(https://github.com/halo951)
 * @license MIT
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("chalk"),t=require("zlib"),i=require("brotli-wasm"),r=require("boxen"),n=require("prettier");function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var l=o(e),s=o(r),a=o(n);function p(e){return e.length}function c(e){const t="string"==typeof e?e.codePointAt(0):0;return 67===t||99===t?99:76===t||108===t?108:82===t||114===t?114:0}const u=e=>{let t="";for(let i=0;i<e.length;i++)t+=String.fromCharCode(e[i]);return t},g=e=>{let t=[];for(let i=0,r=e.length;i<r;++i)t.push(e.charCodeAt(i));return new Uint8Array(t)};exports.totalSize=(e={})=>{const r={};return{name:"rollup-plugin-total-size",async generateBundle(n,o){if(!e.disable)for(const e in o){const n=o[e];let l;"asset"===n.type?l="string"==typeof n.source?n.source:u(n.source):"chunk"===n.type&&(l=n.code);const s=t.gzipSync(l),a=await i.compress(g(l));r[e]={originSize:l.length,gzippedSize:s.length,compressSize:a.length}}},closeBundle(){if(e.disable)return;let t=[["file","origin size","gzipped size","compressed size"].map((e=>l.default.blue(e)))];const i=t=>{let i=e.max&&t>1024*e.max;return l.default[i?"yellow":"white"]((e=>Number((e/1024).toFixed(2)))(t)+"kb")},n=e=>Object.values(r).map((t=>t[e])).reduce(((e,t)=>e+t),0);for(const e in r){const{originSize:n,gzippedSize:o,compressSize:l}=r[e];t.push([e,i(n),i(o),i(l)])}e.total&&(e.max=0,t.push(["总计",i(n("originSize")),i(n("gzippedSize")),i(n("compressSize"))]));let o=function(e,t={}){const i=(t.align||[]).concat(),r=t.stringLength||p,n=[],o=[],l=[],s=[];let a=0,u=-1;for(;++u<e.length;){const i=[],n=[];let p=-1;for(e[u].length>a&&(a=e[u].length);++p<e[u].length;){const o=null==(g=e[u][p])?"":String(g);if(!1!==t.alignDelimiters){const e=r(o);n[p]=e,(void 0===s[p]||e>s[p])&&(s[p]=e)}i.push(o)}o[u]=i,l[u]=n}var g;let d=-1;if("object"==typeof i&&"length"in i)for(;++d<a;)n[d]=c(i[d]);else{const e=c(i);for(;++d<a;)n[d]=e}d=-1;const h=[],f=[];for(;++d<a;){const e=n[d];let i="",r="";99===e?(i=":",r=":"):108===e?i=":":114===e&&(r=":");let o=!1===t.alignDelimiters?1:Math.max(1,s[d]-i.length-r.length);const l=i+"-".repeat(o)+r;!1!==t.alignDelimiters&&(o=i.length+o+r.length,o>s[d]&&(s[d]=o),f[d]=o),h[d]=l}o.splice(1,0,h),l.splice(1,0,f),u=-1;const m=[];for(;++u<o.length;){const e=o[u],i=l[u];d=-1;const r=[];for(;++d<a;){const o=e[d]||"";let l="",p="";if(!1!==t.alignDelimiters){const e=s[d]-(i[d]||0),t=n[d];114===t?l=" ".repeat(e):99===t?e%2?(l=" ".repeat(e/2+.5),p=" ".repeat(e/2-.5)):(l=" ".repeat(e/2),p=l):p=" ".repeat(e)}!1===t.delimiterStart||d||r.push("|"),!1===t.padding||!1===t.alignDelimiters&&""===o||!1===t.delimiterStart&&!d||r.push(" "),!1!==t.alignDelimiters&&r.push(l),r.push(o),!1!==t.alignDelimiters&&r.push(p),!1!==t.padding&&r.push(" "),!1===t.delimiterEnd&&d===a-1||r.push("|")}m.push(!1===t.delimiterEnd?r.join("").replace(/ +$/,""):r.join(""))}return m.join("\n")}(t);o=a.default.format(o,{parser:"markdown"}),console.log(s.default(o,{title:"rollup bundle size",padding:{top:1,bottom:0,left:2,right:2},borderColor:"#0969da"}))}}};
